"use strict";function ResultSet(){this.loaded=!1,this.loading=!0}var module=angular.module("app",["cla.filters","cla.config","ui.utils","ui.router","ui.bootstrap","ui.bootstrap.popover","ui.select","ngSanitize","ngAnimate","ngCsv","angulartics","angulartics.google.analytics"]),filters=angular.module("cla.filters",[]);angular.module("cla.config",[]).provider("$config",function(){function Config($http){this.get=function(done){$http.get("/config").success(function(data,status){done(data||{},status)})}}this.$get=["$http",function($http){return new Config($http)}]}),angular.element(document).ready(function(){angular.bootstrap(document,["app"])}),module.config(["$stateProvider","$urlRouterProvider","$locationProvider",function($stateProvider,$urlRouterProvider,$locationProvider){$stateProvider.state("home",{url:"/",templateUrl:"/templates/home.html",controller:"HomeCtrl"}).state("home.settings",{templateUrl:"/templates/settings.html",controller:"SettingsCtrl",params:{user:{},owner:{},repo:{},gist:{}}}).state("cla",{"abstract":!0,url:"/my-cla",template:"<section ui-view></section>"}).state("cla.myCla",{url:"",templateUrl:"/templates/my-cla.html",controller:"MyClaCtrl"}).state("repo",{"abstract":!0,url:"/:user/:repo?pullRequest",template:"<section ui-view></section>"}).state("repo.cla",{url:"",templateUrl:"/templates/cla.html",controller:"ClaController"}),$urlRouterProvider.otherwise("/"),$locationProvider.html5Mode({enabled:!0,requireBase:!1})}]).run(["$rootScope","$state","$stateParams","$config",function($rootScope,$state,$stateParams,$config){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$config.get(function(data){$rootScope.$config=data,data.gacode&&ga("create",data.gacode,"auto")})}]),ResultSet.prototype.set=function(error,value){this.loaded=!0,this.loading=!1,this.error=error,this.affix=value,this.value=this.value instanceof Array&&value instanceof Array?this.value.concat(value):value},module.factory("$RAW",["$q","$http",function($q,$http){return{call:function(m,functn,data,callback){var now=new Date;return $http.post("/api/"+m+"/"+functn,data).success(function(res){try{res=JSON.parse(res)}catch(ex){}callback(null,res,new Date-now)}).error(function(res){callback(res,null,new Date-now)})},get:function(url,user_token){var deferred=$q.defer(),header={};return header.Accept="application/vnd.github.moondragon+json",user_token&&(header.Authorization="token "+user_token),$http.get(url,{headers:header}).success(function(data){deferred.resolve(data)}).error(function(err){deferred.reject(err)}),deferred.promise}}}]),module.factory("$RPC",["$RAW","$log",function($RAW,$log){return{call:function(m,functn,data,callback){var res=new ResultSet;return $RAW.call(m,functn,data,function(error,value){res.set(error,value),$log.debug("$RPC",m,functn,data,res,res.error),"function"==typeof callback&&callback(res.error,res)}),res}}}]),module.factory("$HUB",["$RAW","$log",function($RAW,$log){function parse_link_header(header){if(0===header.length)throw new Error("input must not be of zero length");var parts=header.split(","),links={};return parts.forEach(function(p){var section=p.split(";");if(2!==section.length)throw new Error('section could not be split on ";"');var url=section[0].replace(/<(.*)>/,"$1").trim(),name=section[1].replace(/rel="(.*)"/,"$1").trim();links[name]=url}),links}var exec=function(type,res,args,call){return $RAW.call("github",type,args,function(error,value){var data=value?value.data:null,meta=value?value.meta:null;if(!data&&value&&(data=value),res.set(error,data),meta){res.meta=meta;var links=meta.link?parse_link_header(meta.link):null;res.hasMore=meta.hasMore||!!links&&!!links.next,res.getMore=res.hasMore?function(){res.loaded=!1,res.loading=!0,links.next?args.url=links.next:args.arg.page=args.arg.page+1||2,exec(type,res,args,call)}:null}$log.debug("$HUB",args,res,res.error),"function"==typeof call&&call(res.error,res)}),res};return{call:function(o,functn,data,callback){return exec("call",new ResultSet,{obj:o,fun:functn,arg:data},callback)},direct_call:function(url,data,callback){return exec("direct_call",new ResultSet,{url:url,arg:data},callback)},wrap:function(o,functn,data,callback){return exec("wrap",new ResultSet,{obj:o,fun:functn,arg:data},callback)}}}]),module.factory("$HUBService",["$q","$HUB",function($q,$HUB){var exec=function(type,o,functn,data,callback){var deferred=$q.defer();return $HUB[type](o,functn,data,function(err,obj){return"function"==typeof callback&&callback(err,obj),err||deferred.resolve(obj),deferred.reject(err)}),deferred.promise},exec_direct=function(type,url,data){var deferred=$q.defer();return $HUB[type](url,data,function(err,obj){return err?deferred.reject(err):obj.hasMore?void obj.getMore():deferred.resolve(obj)}),deferred.promise};return{call:function(o,functn,data,callback){return exec("call",o,functn,data,callback)},direct_call:function(url,data){return exec_direct("direct_call",url,data)},wrap:function(o,functn,data,callback){return exec("wrap",o,functn,data,callback)}}}]),module.factory("$RPCService",["$q","$RPC",function($q,$RPC){return{call:function(o,functn,data,callback){var deferred=$q.defer();return $RPC.call(o,functn,data,function(err,obj){return"function"==typeof callback&&callback(err,obj),err||deferred.resolve(obj),deferred.reject()}),deferred.promise}}}]),module.controller("ClaController",["$window","$scope","$stateParams","$RAW","$RPCService","$HUBService","$sce","$timeout","$http","$q",function($window,$scope,$stateParams,$RAW,$RPCService,$HUBService,$sce,$timeout,$http,$q){function getCLA(){return $RPCService.call("cla","get",{repo:$stateParams.repo,owner:$stateParams.user},function(err,cla){err||($scope.claText=cla.value.raw)})}function checkCLA(){return $RPCService.call("cla","check",{repo:$stateParams.repo,owner:$stateParams.user},function(err,signed){!err&&signed.value&&($scope.signed=!0)})}function checkRepo(callback){return $RPCService.call("repo","check",{repo:$stateParams.repo,owner:$stateParams.user},function(err,exists){callback(exists.value)})}$scope.cla=null,$scope.signed=!1,$scope.repoExists=!1,$scope.params=$stateParams,$scope.user={},$scope.redirect="https://github.com/"+$stateParams.user+"/"+$stateParams.repo;var getUser=function(){return $HUBService.call("user","get",{},function(err,res){err||($scope.user=res,$scope.user.value.admin=!1,res.meta&&res.meta.scopes&&res.meta.scopes.indexOf("write:repo_hook")>-1&&($scope.user.value.admin=!0))})};$scope.agree=function(){var acceptUrl="/accept/"+$stateParams.user+"/"+$stateParams.repo;acceptUrl=$stateParams.pullRequest?acceptUrl+"?pullRequest="+$stateParams.pullRequest:acceptUrl,$window.location.href=acceptUrl};var userPromise=getUser(),repoPromise=checkRepo(function(exists){$scope.repoExists=exists,$scope.repoExists&&getCLA().then(function(data){$scope.cla=$sce.trustAsHtml(data.value.raw),$scope.cla.text=data.value.raw})});$q.all([userPromise,repoPromise]).then(function(){$stateParams.pullRequest&&($scope.redirect=$scope.redirect+"/pull/"+$stateParams.pullRequest),$scope.user&&$scope.user.value&&$scope.repoExists&&checkCLA().then(function(signed){signed.value&&($http.get("/logout?noredirect=true"),$timeout(function(){$window.location.href=$scope.redirect},5e3))})})}]),module.controller("HomeCtrl",["$rootScope","$scope","$document","$HUB","$RPC","$RPCService","$RAW","$HUBService","$window","$modal","$timeout","$q","$location",function($rootScope,$scope,$document,$HUB,$RPC,$RPCService,$RAW,$HUBService,$window,$modal,$timeout,$q,$location){$scope.repos=[],$scope.gists=[],$scope.claRepos=[],$scope.selectedRepo={},$scope.selectedGist={},$scope.query={},$scope.errorMsg=[],$scope.openSettings=!1,$scope.users=[],$scope.selectedIndex=-1,$scope.user={},$scope.nextstep={step1:!0},$scope.active=0,$scope.defaultClas=[];var githubGists="https://api.github.com/gists?per_page=100",githubUserRepos="https://api.github.com/user/repos?per_page=100&affiliation=owner,organization_member";$scope.logAdminIn=function(){$window.location.href="/auth/github?admin=true"},$scope.isNotClaRepo=function(repo){var match=!1;return $scope.claRepos.some(function(claRepo){return match=claRepo.repo===repo.name&&claRepo.owner===repo.owner.login?!0:!1}),!match};var mixRepoData=function(claRepo){return $scope.repos.some(function(repo){return claRepo.repo===repo.name&&claRepo.owner===repo.owner.login?(claRepo.fork=repo.fork,!0):void 0}),claRepo},updateScopeData=function(){var repoSet=[];$scope.repos.forEach(function(repo){repoSet.push({owner:repo.owner.login,repo:repo.name})}),$RPCService.call("repo","getAll",{set:repoSet},function(err,data){$scope.claRepos=data.value,$scope.claRepos.forEach(function(claRepo){claRepo.active=claRepo.gist?!0:!1,claRepo=mixRepoData(claRepo)})})},getUser=function(){return $rootScope.user={value:{admin:!1}},$HUBService.call("user","get",{},function(err,res){err||($scope.user=res,$scope.user.value.admin=!1,res.meta.scopes.indexOf("write:repo_hook")>-1&&($scope.user.value.admin=!0),$rootScope.user=$scope.user,$rootScope.$broadcast("user"))})},getRepos=function(){$scope.user&&$scope.user.value&&$scope.user.value.admin&&$HUB.direct_call(githubUserRepos,{},function(err,data){data.hasMore?data.getMore():(data.value.forEach(function(repo){repo.permissions.push&&$scope.repos.push(repo)}),$scope.repos.length>0&&updateScopeData())})},getGists=function(){$scope.gists=[],$scope.defaultClas.length||$scope.getDefaultClaFiles().then(function(){$scope.gists=$scope.gists.concat($scope.defaultClas)}),$scope.gists=$scope.defaultClas.concat([]),$HUBService.direct_call(githubGists).then(function(data){data&&data.value&&data.value.forEach(function(gist){var gistFile={};gistFile.name=Object.keys(gist.files)[0],gistFile.name=gist.files[gistFile.name].filename?gist.files[gistFile.name].filename:gistFile.name,gistFile.url=gist.html_url,$scope.gists.push(gistFile)})})},showErrorMessage=function(text){var error=text;$timeout(function(){var i=$scope.errorMsg.indexOf(error);i>-1&&$scope.errorMsg.splice(i,1)},3e3),$scope.errorMsg.push(error)},linkSuccess=function(){var modal=$modal.open({templateUrl:"/modals/templates/linkSuccess.html",controller:"LinkCtrl",windowClass:"link-success",scope:$scope,resolve:{selectedGist:function(){return $scope.selectedGist},selectedRepo:function(){return $scope.selectedRepo}}});modal.result.then(function(){$scope.selectedRepo={},$scope.selectedGist={},$scope.newLink=!1},function(){$scope.selectedRepo={},$scope.selectedGist={},$scope.newLink=!1})},confirmAdd=function(){var modal=$modal.open({templateUrl:"/modals/templates/confirmLink.html",controller:"ConfirmCtrl",windowClass:"confirm-add",resolve:{selectedGist:function(){return $scope.selectedGist},selectedRepo:function(){return $scope.selectedRepo}}});modal.result.then(function(){$scope.linkStatus=null,linkSuccess(),$scope.link().then(function(){$scope.linkStatus="linked"},function(){$scope.linkStatus="failed"})})};$scope.confirmRemove=function(claRepo){var modal=$modal.open({templateUrl:"/modals/templates/confirmRemove.html",controller:"ConfirmCtrl",windowClass:"confirm-add",resolve:{selectedGist:function(){return{}},selectedRepo:function(){return claRepo}}});modal.result.then(function(repo){$scope.remove(repo)})},$scope.info=function(){$modal.open({templateUrl:"/modals/templates/info_gist.html",controller:"InfoCtrl",windowClass:"howto"})},$scope.getDefaultClaFiles=function(){return $RAW.get("/static/cla-assistant.json").then(function(data){$scope.defaultClas=data["default-cla"]})},$scope.count=function(){$RAW.get("/count/clas").then(function(data){$scope.numberClas=data.count}),$RAW.get("/count/repos").then(function(data){$scope.numberRepos=data.count}),$RAW.get("/count/stars").then(function(data){$scope.numberStars=data.count})},getUser().then(function(){getRepos(),getGists()},function(){$scope.count()}),$scope.clear=function($event,obj){$event.stopPropagation(),"repo"===obj?$scope.selectedRepo.repo=void 0:"gist"===obj&&($scope.selectedGist.gist=void 0)},$scope.isValid=function(gist){var valid=!1;return valid=gist?!!gist.match(/https:\/\/gist\.github\.com\/([a-zA-Z0-9_-]*)/):!1},$scope.addWebhook=function(claRepo){claRepo.gist&&$RPCService.call("webhook","create",{repo:claRepo.repo,owner:claRepo.owner},function(err,data){!err&&data&&data.value&&(claRepo.active=data.value.active)})},$scope.removeWebhook=function(claRepo){$RPCService.call("webhook","remove",{repo:claRepo.repo,user:claRepo.owner},function(err){err||(claRepo.active=!1)})},$scope.addRepo=function(){confirmAdd()},$scope.link=function(){var newClaRepo={repo:$scope.selectedRepo.repo.name,owner:$scope.selectedRepo.repo.owner.login,gist:$scope.selectedGist.gist.url,active:!1};newClaRepo=mixRepoData(newClaRepo);var promise1=$RPCService.call("repo","create",{repo:newClaRepo.repo,owner:newClaRepo.owner,gist:newClaRepo.gist},function(err,data){if(err&&err.err.match(/.*duplicate key error.*/)&&showErrorMessage("This repository is already set up."),err||!data.value){$scope.removeWebhook(newClaRepo);var i=$scope.claRepos.indexOf(newClaRepo);i>-1&&$scope.claRepos.splice(i,1)}else $scope.claRepos.push(newClaRepo),$scope.query.text=""}),promise2=$scope.addWebhook(newClaRepo);return $q.all([promise1,promise2])},$scope.remove=function(claRepo){$RPCService.call("repo","remove",{repo:claRepo.repo,owner:claRepo.owner,gist:claRepo.gist},function(err){if(!err){var i=$scope.claRepos.indexOf(claRepo);i>-1&&$scope.claRepos.splice(i,1)}}),$RPCService.call("webhook","remove",{repo:claRepo.repo,user:claRepo.owner},function(err){err||(claRepo.active=!1)})},$scope.isActive=function(viewLocation){return viewLocation===$location.url()},$scope.groupDefaultCla=function(gist){var found=!1;return $scope.defaultClas.some(function(defCla){return gist.url===defCla.url?found=!0:void 0}),found?"Default CLAs":"My Gist Files"}}]).directive("feature",["$window",function(){return{templateUrl:"/templates/feature.html",scope:{id:"@",iconSrc:"@",header:"@",text:"@"}}}]).directive("textSlider",["$window","$timeout",function($window,$timeout){return{scope:{time:"@",active:"="},link:function(scope,element){var children=element.children(),start=function(){$timeout(function(){scope.active=scope.active+1===children.length?0:scope.active+1,start()},scope.time)};start()}}}]),filters.filter("notIn",function(){return function(repos,arr){if(0===arr.length)return repos;var notMatched=[];return repos.forEach(function(item){var found=!1;arr.some(function(claRepo){return found=claRepo.repo===item.name&&claRepo.owner===item.owner.login?!0:!1}),found||notMatched.push(item)}),notMatched}}),module.controller("MyClaCtrl",["$scope","$filter","$HUB","$RAW","$RPCService","$HUBService","$modal",function($scope,$filter,$HUB,$RAW,$RPCService,$HUBService,$modal){function getLinkedGist(claRepo){return $RPCService.call("cla","getGist",{repo:claRepo.repo,owner:claRepo.owner},function(err,data){!err&&data.value&&(claRepo.newCLA=data.value)})}function checkCLA(claRepo){return $RPCService.call("cla","check",{repo:claRepo.repo,owner:claRepo.owner},function(err,signed){!err&&signed.value&&signed?claRepo.signed=!0:(claRepo.signed=!1,getLinkedGist(claRepo))})}$scope.repos=[],$scope.gists=[],$scope.claRepos=[],$scope.signedCLAs=[],$scope.users=[],$scope.user={},$scope.defaultClas=[];var orderBy=$filter("orderBy"),getUser=function(){return $scope.user={value:{admin:!1}},$HUBService.call("user","get",{},function(err,res){err||($scope.user=res,$scope.user.value.admin=!1,res.meta.scopes.indexOf("write:repo_hook")>-1&&($scope.user.value.admin=!0))})},getSignedCLA=function(){return $RPCService.call("cla","getSignedCLA",{user:$scope.user.value.login},function(err,data){$scope.claRepos=data.value;for(var i=0;i<$scope.claRepos.length;i++)$scope.getGist($scope.claRepos[i]),$scope.getVersionStatus($scope.claRepos[i])})};$scope.getGist=function(repo){$RPCService.call("cla","getGist",{repo:repo.repo,owner:repo.owner,gist:{gist_url:repo.gist_url,gist_version:repo.gist_version}},function(err,data){!err&&data.value&&(repo.gistObj=data.value)})},$scope.getGistName=function(gistObj){var fileName="";return gistObj&&gistObj.files&&(fileName=Object.keys(gistObj.files)[0],fileName=gistObj.files[fileName].filename?gistObj.files[fileName].filename:fileName),fileName},getUser().then(function(){getSignedCLA()}),$scope.order=function(predicate,reverse){$scope.claRepos=orderBy($scope.claRepos,predicate,reverse)},$scope.getDefaultClaFiles=function(){return $RAW.get("/static/cla-assistant.json").then(function(data){$scope.defaultClas=data["default-cla"]})},$scope.getClaView=function(claRepo){$modal.open({templateUrl:"/modals/templates/claView.html",controller:"ClaViewCtrl",scope:$scope,resolve:{cla:function(){return claRepo}}})},$scope.getGistVersion=function(gistObj){var fileVersion="";return gistObj&&gistObj.files&&(fileVersion=Object.keys(gistObj.files)[0],fileVersion=gistObj.files[fileVersion].updated_at?gistObj.files[fileVersion].updated_at:fileVersion),fileVersion},$scope.getVersionView=function(claRepo){claRepo.newCLA?(claRepo.noCLA=!1,claRepo.newCLA.html_url!==claRepo.gist_url?claRepo.showCLA=!0:claRepo.showCLA=!1):claRepo.noCLA=!0,$modal.open({templateUrl:"/modals/templates/versionView.html",controller:"VersionViewCtrl",scope:$scope,resolve:{cla:function(){return claRepo},noCLA:function(){return claRepo.noCLA},showCLA:function(){return claRepo.showCLA}}})},$scope.getVersionStatus=function(claRepo){checkCLA(claRepo).then(function(){claRepo.signed?claRepo.stat=!0:claRepo.stat=!1})}}]),module.controller("RootCtrl",["$rootScope","$scope","$stateParams","$HUB","$RPC","$RAW","$timeout",function($rootScope,$scope,$stateParams,$HUB,$RPC,$RAW,$timeout){}]),module.controller("SettingsCtrl",["$rootScope","$scope","$stateParams","$HUB","$RPC","$RPCService","$HUBService","$window","$sce","$modal","$q",function($rootScope,$scope,$stateParams,$HUB,$RPC,$RPCService,$HUBService,$window,$sce,$modal,$q){function gistArgs(){var args={gist_url:$scope.repo.gist};return $scope.gist.history&&$scope.gist.history.length>0&&(args.gist_version=$scope.gist.history[$scope.gistIndex].version),args}$scope.gist={},$scope.gistIndex=0,$scope.admin=!1,$scope.errorMsg=[],$scope.loading=!1,$scope.gistUrlIsValid=!0,$scope.valid={},$scope.signatures={},$scope.contributors=[];var webhook={};$scope.csvHeader=["User Name","Repository Owner","Repository Name","CLA Title","Gist URL","Gist Version","Signed At"];$scope.open_error=function(){$modal.open({templateUrl:"/modals/templates/error_modal.html",controller:"ErrorCtrl"})},$scope.getSignatures=function(claRepo,gist_version,cb){return $RPC.call("cla","getAll",{repo:claRepo.repo,owner:claRepo.owner,gist:{gist_url:claRepo.gist,gist_version:gist_version}},cb)};var getWebhook=function(){return $RPCService.call("webhook","get",{repo:$scope.repo.repo,user:$scope.repo.owner},function(err,obj){!err&&obj&&obj.value&&(webhook=obj.value,$scope.valid.webhook=webhook.active)})},getGithubUserData=function(login){return $HUBService.call("user","getFrom",{user:login})};$scope.getContributors=function(gist_version){return $scope.getSignatures($scope.repo,gist_version,function(err,data){$scope.contributors=[],data&&data.value&&data.value.length>0&&data.value.forEach(function(signature){var contributor={};contributor.user_name=signature.user,contributor.repo_owner=$scope.repo.owner,contributor.repo_name=$scope.repo.repo,contributor.gist_name=$scope.getGistName(),contributor.gist_url=$scope.gist.url,contributor.gist_version=signature.gist_version,contributor.signed_at=signature.created_at,$scope.contributors.push(contributor),getGithubUserData(signature.user).then(function(user){contributor.html_url=user.html_url})})})},$scope.getGist=function(){return $RPCService.call("cla","getGist",{repo:$scope.repo.repo,owner:$scope.repo.owner,gist:gistArgs()},function(err,data){!err&&data.value&&($scope.gist=data.value,$scope.valid.gist=$scope.gist&&$scope.gist.id?!0:!1),$scope.gist.linked=!0})},$scope.getGistName=function(){var fileName="";return $scope.gist&&$scope.gist.files&&(fileName=Object.keys($scope.gist.files)[0],fileName=$scope.gist.files[fileName].filename?$scope.gist.files[fileName].filename:fileName),fileName},$scope.validateLinkedRepo=function(){var promises=[];$scope.repo.gist&&($scope.loading=!0,promises.push($scope.getGist()),promises.push(getWebhook()),$q.all(promises).then(function(){$scope.signatures=$scope.getSignatures($scope.repo,gistArgs().gist_version),$scope.loading=!1}))},$scope.isLinkActive=function(){return!$scope.loading&&$scope.valid.gist&&$scope.valid.webhook?!0:!1},$scope.renderHtml=function(html_code){return $sce.trustAsHtml(html_code)};var report=function(claRepo){$modal.open({templateUrl:"/modals/templates/report.html",controller:"ReportCtrl",windowClass:"report",scope:$scope,resolve:{repo:function(){return claRepo}}})};$scope.getReport=function(){$scope.signatures.value.length>0&&$scope.getContributors(gistArgs().gist_version),report($scope.repo)},$scope.recheck=function(claRepo){$scope.validatePR=$RPC.call("cla","validatePullRequests",{repo:claRepo.repo,owner:claRepo.owner},function(){$scope.popoverIsOpen=!1})},$scope.upload=function(claRepo){$scope.popoverIsOpen=!1;var modal=$modal.open({templateUrl:"/modals/templates/upload.html",controller:"UploadCtrl",windowClass:"upload"});modal.result.then(function(users){$RPCService.call("cla","upload",{repo:claRepo.repo,owner:claRepo.owner,users:users}).then($scope.validateLinkedRepo)})},$scope.validateLinkedRepo()}]),module.directive("settings",["$document",function($document){return{templateUrl:"/templates/settings.html",controller:"SettingsCtrl",transclude:!0,scope:{repo:"=",user:"="},link:function(scope,element,attrs,controller){var documentClickHandler=function(event){var eventOutsideTarget=element[0]!==event.target&&0===element.find(event.target).length;eventOutsideTarget&&scope.$apply(function(){scope.popoverIsOpen=!1})};$document.on("click",documentClickHandler),scope.$on("$destroy",function(){$document.off("click",documentClickHandler)})}}}]),module.controller("ClaViewCtrl",function($scope,$modalInstance,$window,cla,$state,$RPCService,$sce){function getCLA(){return $RPCService.call("cla","get",{repo:$scope.claObj.repo,owner:$scope.claObj.owner,gist:{gist_url:$scope.claObj.gist_url,gist_version:$scope.claObj.gist_version}},function(err,gist){err||($scope.claText=gist.value.raw)})}$scope.claObj=cla,$scope.cla=null,$scope.modalInstance=$modalInstance,$scope.getGistName=function(gistObj){var fileName="";return gistObj&&gistObj.files&&(fileName=Object.keys(gistObj.files)[0],fileName=gistObj.files[fileName].filename?gistObj.files[fileName].filename:fileName),fileName},getCLA().then(function(data){$scope.cla=$sce.trustAsHtml(data.value.raw),$scope.cla.text=data.value.raw}),$scope.cancel=function(){$modalInstance.dismiss("cancel")}}).directive("clacontent",[function(){return{link:function(scope,element,attrs){scope.$watch(attrs.clacontent,function(content){if(content){var linkIcons=element[0].getElementsByClassName("octicon octicon-link");for(var index in linkIcons)linkIcons.hasOwnProperty(index)&&angular.element(linkIcons[index]).removeClass("octicon octicon-link")}})}}}]),module.controller("ConfirmCtrl",function($scope,$modalInstance,$window,$timeout,selectedGist,selectedRepo){$scope.gist=selectedGist&&selectedGist.gist?selectedGist.gist:null,$scope.repo=selectedRepo&&selectedRepo.repo?selectedRepo.repo:null,$scope.ok=function(){$modalInstance.close(selectedRepo)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),module.controller("ErrorCtrl",function($scope,$modalInstance){$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),module.controller("InfoCtrl",function($scope,$modalInstance,$window){$scope.origin=$window.location.origin,$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),module.controller("LinkCtrl",function($scope,$modalInstance){$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),module.controller("ReportCtrl",function($scope,$modalInstance,$window,repo){$scope.claRepo=repo,$scope.newContributors={loading:!1},$scope.history=$scope.gist.history,$scope.selectedVersion={},$scope.selectedVersion.version=$scope.gist.history[0],$scope.history.push({text:"All versions"}),$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),module.controller("UploadCtrl",function($scope,$modalInstance){$scope.json={},$scope.$watch("file",function(){$scope.file&&Papa.parse($scope.file,{complete:function(data){$scope.json=data}})}),$scope.upload=function(index){for(var data=[],i=$scope.header?1:0;i<$scope.json.data.length;i++)data.push($scope.json.data[i][index]);$modalInstance.close(data)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}).directive("fileModel",function(){return{scope:{fileModel:"="},link:function(scope,elem,attr){elem.bind("change drop",function(change){var reader=new FileReader;reader.onload=function(load){scope.$apply(function(){scope.fileModel=load.target.result})},reader.readAsText(change.target.files[0])}),elem.bind("ondragenter",function(){console.log("dude...")})}}}),module.controller("VersionViewCtrl",function($scope,$modalInstance,cla,noCLA,showCLA,$window){$scope.claObj=cla,$scope.noCLA=noCLA,$scope.showCLA=showCLA,$scope.cla=null,$scope.modalInstance=$modalInstance,$scope.newCLA=null,$scope.openNewCla=function(){$modalInstance.dismiss("Link opened"),$window.open("/"+$scope.claObj.owner+"/"+$scope.claObj.repo)},$scope.openRevision=function(){$window.open($scope.claObj.gist_url+"/revisions")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}});
//# sourceMappingURL=app.min.js.map